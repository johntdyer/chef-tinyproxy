# This file is automagically generated by Chef.
# Local changes will be overwritten!

User <%= node[:tinyproxy][:user] %>
Group <%= node[:tinyproxy][:group] %>

Port <%= node[:tinyproxy][:port] %>
Listen <%= node[:tinyproxy][:listen_address] %>
Timeout <%= node[:tinyproxy][:timeout] %>

DefaultErrorFile "/usr/share/tinyproxy/default.html"
StatFile "/usr/share/tinyproxy/stats.html"

<% if node[:tinyproxy][:logging][:mode] == 'file' %>
LogFile "<%= node[:tinyproxy][:logging][:file] %>"
<% end %>
<% if node[:tinyproxy][:logging][:mode] == 'syslog' %>
Syslog On
<% end %>
LogLevel <%= node[:tinyproxy][:logging][:level] %>

PidFile "<%= node[:tinyproxy][:pid_file] %>"

<% if node[:tinyproxy][:x_tinyproxy_header] -%>
XTinyproxy Yes
<% end -%>

<% if node[:tinyproxy][:upstream] -%>
Upstream <%= node[:tinyproxy][:upstream] %>
<% unless node[:tinyproxy][:no_upstream].empty? -%>

<% node[:tinyproxy][:no_upstream].each |up| -%>
no upstream "<%=up%>"
<% end -%>

<% end -%>

<% unless node[:tinyproxy][:match_urls].empty? -%>
Filter "/etc/tinyproxy/filters"
FilterDefaultDeny <%= node[:tinyproxy][:filter_deafult_deny] == true ? "Yes" : "No" %>
FilterURLs <%= node[:tinyproxy][:filter_urls] == true ? "Yes" : "No" %>
<% end -%>

MaxClients 100
MinSpareServers 5
MaxSpareServers 20
StartServers 10
MaxRequestsPerChild 0

<% node[:tinyproxy][:allow].each do |a| %>
Allow <%= a %>
<% end %>

ViaProxyName "tinyproxy"

<% if node[:tinyproxy][:disableviaheader] -%>
DisableViaHeader Yes
<% end -%>

ConnectPort 443
